"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const config = require('../../config/config');
const path = require('path');
const Vision = require('@google-cloud/vision');
const colors = require('colors/safe');
function respondWithResult(res, statusCode) {
    statusCode = statusCode || 200;
    return function (entity) {
        if (entity) {
            return res.status(statusCode).json(entity);
        }
        return null;
    };
}
function handleError(res, statusCode) {
    statusCode = statusCode || 500;
    return function (err) {
        res.status(statusCode).send(err);
    };
}
function handleEntityNotFound(res) {
    return function (entity) {
        if (!entity) {
            res.status(404).end();
            return null;
        }
        return entity;
    };
}
function analyzeImage(req, res) {
    const fileName = `${config.rootPath}/assets/demo-image.jpg`;
    // Instantiates a client
    const vision = Vision({
        projectId: 'cloudapis-166021',
        keyFilename: config.rootPath + '/config/CloudAPIS-f102f98da353.json'
    });
    const types = ['crops', 'document', 'faces', 'landmarks', 'labels', 'logos', 'properties', 'safeSearch', 'similar', 'text'];
    vision.detect(fileName, types)
        .then(handleEntityNotFound(res))
        .then(respondWithResult(res))
        .catch(handleError(res));
    return null;
}
exports.analyzeImage = analyzeImage;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcGkvdmlzaW9uLjEvdmlzaW9uLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFLQSxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUM5QyxNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0IsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDL0MsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBRXRDLDJCQUEyQixHQUFhLEVBQUUsVUFBbUI7SUFDM0QsVUFBVSxHQUFHLFVBQVUsSUFBSSxHQUFHLENBQUM7SUFDL0IsTUFBTSxDQUFDLFVBQVMsTUFBVztRQUN6QixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ1gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdDLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELHFCQUFxQixHQUFhLEVBQUUsVUFBbUI7SUFDckQsVUFBVSxHQUFHLFVBQVUsSUFBSSxHQUFHLENBQUM7SUFDL0IsTUFBTSxDQUFDLFVBQVMsR0FBd0I7UUFDdEMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbkMsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELDhCQUE4QixHQUFhO0lBQ3pDLE1BQU0sQ0FBQyxVQUFTLE1BQVc7UUFDekIsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ1gsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUN0QixNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUNELE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDaEIsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELHNCQUE2QixHQUFZLEVBQUUsR0FBYTtJQUN0RCxNQUFNLFFBQVEsR0FBRyxHQUFHLE1BQU0sQ0FBQyxRQUFRLHdCQUF3QixDQUFDO0lBQzVELHdCQUF3QjtJQUN4QixNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDcEIsU0FBUyxFQUFFLGtCQUFrQjtRQUM3QixXQUFXLEVBQUUsTUFBTSxDQUFDLFFBQVEsR0FBRyxxQ0FBcUM7S0FDckUsQ0FBQyxDQUFDO0lBRUgsTUFBTSxLQUFLLEdBQUcsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUU1SCxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUM7U0FDM0IsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQy9CLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUM1QixLQUFLLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDM0IsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFmRCxvQ0FlQyIsImZpbGUiOiJzcmMvYXBpL3Zpc2lvbi4xL3Zpc2lvbi5jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBSZXF1ZXN0LFxuICAgIFJlc3BvbnNlLFxuICAgIEVycm9yUmVxdWVzdEhhbmRsZXJcbn0gZnJvbSAnZXhwcmVzcyc7XG5jb25zdCBjb25maWcgPSByZXF1aXJlKCcuLi8uLi9jb25maWcvY29uZmlnJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgVmlzaW9uID0gcmVxdWlyZSgnQGdvb2dsZS1jbG91ZC92aXNpb24nKTtcbmNvbnN0IGNvbG9ycyA9IHJlcXVpcmUoJ2NvbG9ycy9zYWZlJyk7XG5cbmZ1bmN0aW9uIHJlc3BvbmRXaXRoUmVzdWx0KHJlczogUmVzcG9uc2UsIHN0YXR1c0NvZGU/OiBudW1iZXIpIHtcbiAgc3RhdHVzQ29kZSA9IHN0YXR1c0NvZGUgfHwgMjAwO1xuICByZXR1cm4gZnVuY3Rpb24oZW50aXR5OiBhbnkpIHtcbiAgICBpZiAoZW50aXR5KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyhzdGF0dXNDb2RlKS5qc29uKGVudGl0eSk7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9O1xufVxuXG5mdW5jdGlvbiBoYW5kbGVFcnJvcihyZXM6IFJlc3BvbnNlLCBzdGF0dXNDb2RlPzogbnVtYmVyKSB7XG4gIHN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlIHx8IDUwMDtcbiAgcmV0dXJuIGZ1bmN0aW9uKGVycjogRXJyb3JSZXF1ZXN0SGFuZGxlcikge1xuICAgIHJlcy5zdGF0dXMoc3RhdHVzQ29kZSkuc2VuZChlcnIpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBoYW5kbGVFbnRpdHlOb3RGb3VuZChyZXM6IFJlc3BvbnNlKSB7XG4gIHJldHVybiBmdW5jdGlvbihlbnRpdHk6IGFueSkge1xuICAgIGlmKCFlbnRpdHkpIHtcbiAgICAgIHJlcy5zdGF0dXMoNDA0KS5lbmQoKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gZW50aXR5O1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYW5hbHl6ZUltYWdlKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IG51bGwge1xuICBjb25zdCBmaWxlTmFtZSA9IGAke2NvbmZpZy5yb290UGF0aH0vYXNzZXRzL2RlbW8taW1hZ2UuanBnYDtcbiAgLy8gSW5zdGFudGlhdGVzIGEgY2xpZW50XG4gIGNvbnN0IHZpc2lvbiA9IFZpc2lvbih7XG4gICAgcHJvamVjdElkOiAnY2xvdWRhcGlzLTE2NjAyMScsXG4gICAga2V5RmlsZW5hbWU6IGNvbmZpZy5yb290UGF0aCArICcvY29uZmlnL0Nsb3VkQVBJUy1mMTAyZjk4ZGEzNTMuanNvbidcbiAgfSk7XG5cbiAgY29uc3QgdHlwZXMgPSBbJ2Nyb3BzJywgJ2RvY3VtZW50JywgJ2ZhY2VzJywgJ2xhbmRtYXJrcycsICdsYWJlbHMnLCAnbG9nb3MnLCAncHJvcGVydGllcycsICdzYWZlU2VhcmNoJywgJ3NpbWlsYXInLCAndGV4dCddO1xuXG4gIHZpc2lvbi5kZXRlY3QoZmlsZU5hbWUsIHR5cGVzKVxuICAgIC50aGVuKGhhbmRsZUVudGl0eU5vdEZvdW5kKHJlcykpXG4gICAgLnRoZW4ocmVzcG9uZFdpdGhSZXN1bHQocmVzKSlcbiAgICAuY2F0Y2goaGFuZGxlRXJyb3IocmVzKSk7XG4gIHJldHVybiBudWxsO1xufSJdfQ==
